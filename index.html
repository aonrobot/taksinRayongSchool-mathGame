<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Student | Matthayomtaksinrayong School</title>
    <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css">
    <script src="/components/socket.io/socket.io.js"></script>
    <script src="/components/jquery/dist/jquery.min.js"></script>
</head>
<body>
    <div class="prepare">
        name <input type="text" id="name">
        <button class="btn btn-primary" id="startBtn">Join</button>
    </div>
    <div class="waitingStart">
        <h3>Waiting for start game...</h3>
    </div>
    <div class="start">
        <h3>Trigonometry Game</h3>
        <div class="problem">
            <div class="card text-center">
                <div class="card-header">
                    ไปหาคำตอบจากเพื่อนๆกันเร็วว
                </div>
                <div class="card-body">
                    <h2 class="card-title" id="problem-title">Special title treatment</h2>
                    <p class="card-text">....</p>
                    <img width="100%" id="problem-img">
                </div>
            </div>
        </div>
    </div>

    <div class="message"></div>

    <script>
        $('.waitingStart').hide()
        $('.start').hide()
        $('.sorry').hide()

        $(document).ready(function(){
            var socket = io('/student');
            var studentInfo;
            var name = "";
            var clickJoinGame = false;

            $('#startBtn').bind('click', function(){
                var id = socket.io.engine.id
                name = $('#name').val()

                if(name === ""){
                    $('.message').empty().append("Cann't start game please enter your name first")
                }else{
                    studentInfo = {id : '/student#'+id, name : name}
                    socket.emit('student', studentInfo)
                    clickJoinGame = true;
                    $('.prepare').hide()
                    $('.message').empty()
                    $('.waitingStart').show()
                }
            })

            socket.on('gameStatus', function(data){
                console.log('Now game status is -> ', data.status)
                if(data.status === 'playing'){

                    if(!clickJoinGame){
                        $('.prepare').hide()
                        $('.waitingStart').hide()
                        $('.message').empty().append("ขณะนี้เกมส์ได้ทำการเริ่มไปแล้ว กรุณารอเล่นในรอบถัดไปนะค้าบบ >.<")
                    }else{
                        $('.prepare').hide()
                        $('.waitingStart').hide()
                        $('.start').show()
                    }
                    
                }else if(data.status === 'stop'){
                    $('.start').hide()
                    $('.sorry').hide()
                    $('.waitingStart').hide()
                    clickJoinGame = false;

                    $('.prepare').show()
                    $('.message').empty().append('Game Was Stoped..')
                }else if(data.status === 'disconnect'){
                    $('.prepare').hide()
                    $('.waitingStart').hide()
                    clickJoinGame = false;

                    $('.message').empty().append("ขณะนี้เกมส์ได้ทำการเริ่มไปแล้ว กรุณารอเล่นในรอบถัดไปนะค้าบบ >.<")
                }
            })

            socket.on('problem', function(data) {
                var problem = data.problem
                var p_title = $('#problem-title')
                var p_img = $('#problem-img')
                if(problem.type == 'question'){
                    p_title.html(problem.question_title)
                    p_img.attr('src', '/question_images/' + problem.question_img)
                    p_img.show()
                }else if(problem.type == 'answer'){
                    p_title.html(problem.answer_title)
                    p_img.attr('src', '')                    
                    p_img.hide()
                }
                console.log('problem is -> ', data.problem)
            });

            socket.on('disconnect', function() {
                $('.start').hide()
                $('.waitingStart').hide()
                clickJoinGame = false;

                $('.prepare').show()        
                $('.message').empty().append('Disconnect to game server success...')
            });
            socket.on('connect', function() {
                clickJoinGame = false;
                $('.message').empty().append('Connect to game server success...')
            });
        })
   </script>
</body>
</html>